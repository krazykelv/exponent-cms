YUI.add("uploader-flash",function(Y,NAME){var substitute=Y.Lang.sub,UploaderQueue=Y.Uploader.Queue;function UploaderFlash(){UploaderFlash.superclass.constructor.apply(this,arguments);}Y.UploaderFlash=Y.extend(UploaderFlash,Y.Widget,{_buttonState:"up",_buttonFocus:false,_swfContainerId:null,_swfReference:null,queue:null,_tabElementBindings:null,initializer:function(){this._swfContainerId=Y.guid("uploader");this._swfReference=null;this.queue=null;this._buttonState="up";this._buttonFocus=null;this._tabElementBindings=null;this._fileList=[];this.publish("fileselect");this.publish("uploadstart");this.publish("fileuploadstart");this.publish("uploadprogress");this.publish("totaluploadprogress");this.publish("uploadcomplete");this.publish("alluploadscomplete");this.publish("uploaderror");this.publish("mouseenter");this.publish("mouseleave");this.publish("mousedown");this.publish("mouseup");this.publish("click");},renderUI:function(){var boundingBox=this.get("boundingBox"),contentBox=this.get("contentBox"),selFilesButton=this.get("selectFilesButton"),flashContainer=Y.Node.create(substitute(UploaderFlash.FLASH_CONTAINER,{swfContainerId:this._swfContainerId})),params={version:"10.0.45",fixedAttributes:{wmode:"transparent",allowScriptAccess:"always",allowNetworking:"all",scale:"noscale"}};boundingBox.setStyle("position","relative");selFilesButton.setStyles({width:"100%",height:"100%"});contentBox.append(selFilesButton);contentBox.append(flashContainer);this._swfReference=new Y.SWF(flashContainer,this.get("swfURL"),params);},bindUI:function(){this._swfReference.on("swfReady",function(){this._setMultipleFiles();this._setFileFilters();this._triggerEnabled();this._attachTabElements();this.after("multipleFilesChange",this._setMultipleFiles,this);this.after("fileFiltersChange",this._setFileFilters,this);this.after("enabledChange",this._triggerEnabled,this);this.after("tabElementsChange",this._attachTabElements);},this);this._swfReference.on("fileselect",this._updateFileList,this);this._swfReference.on("mouseenter",function(){this.fire("mouseenter");this._setButtonClass("hover",true);if(this._buttonState==="down"){this._setButtonClass("active",true);}},this);this._swfReference.on("mouseleave",function(){this.fire("mouseleave");this._setButtonClass("hover",false);this._setButtonClass("active",false);},this);this._swfReference.on("mousedown",function(){this.fire("mousedown");this._buttonState="down";this._setButtonClass("active",true);},this);this._swfReference.on("mouseup",function(){this.fire("mouseup");this._buttonState="up";this._setButtonClass("active",false);},this);this._swfReference.on("click",function(){this.fire("click");this._buttonFocus=true;this._setButtonClass("focus",true);Y.one("body").focus();this._swfReference._swf.focus();},this);},_attachTabElements:function(){if(this.get("tabElements")!==null&&this.get("tabElements").from!==null&&this.get("tabElements").to!==null){if(this._tabElementBindings!==null){this._tabElementBindings.from.detach();this._tabElementBindings.to.detach();this._tabElementBindings.tabback.detach();this._tabElementBindings.tabforward.detach();this._tabElementBindings.focus.detach();this._tabElementBindings.blur.detach();}else{this._tabElementBindings={};}var fromElement=Y.one(this.get("tabElements").from),toElement=Y.one(this.get("tabElements").to);this._tabElementBindings.from=fromElement.on("keydown",function(ev){if(ev.keyCode===9&&!ev.shiftKey){ev.preventDefault();this._swfReference._swf.setAttribute("tabindex",0);this._swfReference._swf.setAttribute("role","button");this._swfReference._swf.setAttribute("aria-label",this.get("selectButtonLabel"));this._swfReference._swf.focus();}},this);this._tabElementBindings.to=toElement.on("keydown",function(ev){if(ev.keyCode===9&&ev.shiftKey){ev.preventDefault();this._swfReference._swf.setAttribute("tabindex",0);this._swfReference._swf.setAttribute("role","button");this._swfReference._swf.setAttribute("aria-label",this.get("selectButtonLabel"));this._swfReference._swf.focus();}},this);this._tabElementBindings.tabback=this._swfReference.on("tabback",function(){this._swfReference._swf.blur();setTimeout(function(){fromElement.focus();},30);},this);this._tabElementBindings.tabforward=this._swfReference.on("tabforward",function(){this._swfReference._swf.blur();setTimeout(function(){toElement.focus();},30);},this);this._tabElementBindings.focus=this._swfReference._swf.on("focus",function(){this._buttonFocus=true;this._setButtonClass("focus",true);},this);this._tabElementBindings.blur=this._swfReference._swf.on("blur",function(){this._buttonFocus=false;this._setButtonClass("focus",false);},this);}else{if(this._tabElementBindings!==null){this._tabElementBindings.from.detach();this._tabElementBindings.to.detach();this._tabElementBindings.tabback.detach();this._tabElementBindings.tabforward.detach();this._tabElementBindings.focus.detach();this._tabElementBindings.blur.detach();}}},_setButtonClass:function(state,add){if(add){this.get("selectFilesButton").addClass(this.get("buttonClassNames")[state]);}else{this.get("selectFilesButton").removeClass(this.get("buttonClassNames")[state]);}},_setFileFilters:function(){if(this._swfReference&&this.get("fileFilters").length>0){this._swfReference.callSWF("setFileFilters",[this.get("fileFilters")]);}},_setMultipleFiles:function(){if(this._swfReference){this._swfReference.callSWF("setAllowMultipleFiles",[this.get("multipleFiles")]);}},_triggerEnabled:function(){if(this.get("enabled")){this._swfReference.callSWF("enable");this._swfReference._swf.setAttribute("aria-disabled","false");this._setButtonClass("disabled",false);}else{this._swfReference.callSWF("disable");this._swfReference._swf.setAttribute("aria-disabled","true");this._setButtonClass("disabled",true);}},_getFileList:function(){return this._fileList.concat();},_setFileList:function(val){this._fileList=val.concat();return this._fileList.concat();},_updateFileList:function(ev){Y.one("body").focus();this._swfReference._swf.focus();var newfiles=ev.fileList,fileConfObjects=[],parsedFiles=[],swfRef=this._swfReference,filterFunc=this.get("fileFilterFunction"),oldfiles;Y.each(newfiles,function(value){var newFileConf={};newFileConf.id=value.fileId;newFileConf.name=value.fileReference.name;newFileConf.size=value.fileReference.size;newFileConf.type=value.fileReference.type;newFileConf.dateCreated=value.fileReference.creationDate;newFileConf.dateModified=value.fileReference.modificationDate;newFileConf.uploader=swfRef;fileConfObjects.push(newFileConf);});if(filterFunc){Y.each(fileConfObjects,function(value){var newfile=new Y.FileFlash(value);if(filterFunc(newfile)){parsedFiles.push(newfile);}});}else{Y.each(fileConfObjects,function(value){parsedFiles.push(new Y.FileFlash(value));});}if(parsedFiles.length>0){oldfiles=this.get("fileList");this.set("fileList",this.get("appendNewFiles")?oldfiles.concat(parsedFiles):parsedFiles);this.fire("fileselect",{fileList:parsedFiles});}},_uploadEventHandler:function(event){switch(event.type){case"file:uploadstart":this.fire("fileuploadstart",event);break;case"file:uploadprogress":this.fire("uploadprogress",event);break;case"uploaderqueue:totaluploadprogress":this.fire("totaluploadprogress",event);break;case"file:uploadcomplete":this.fire("uploadcomplete",event);break;case"uploaderqueue:alluploadscomplete":this.queue=null;this.fire("alluploadscomplete",event);break;case"file:uploaderror":case"uploaderqueue:uploaderror":this.fire("uploaderror",event);break;case"file:uploadcancel":case"uploaderqueue:uploadcancel":this.fire("uploadcancel",event);break;}},upload:function(file,url,postvars){var uploadURL=url||this.get("uploadURL"),postVars=postvars||this.get("postVarsPerFile"),fileId=file.get("id");postVars=postVars.hasOwnProperty(fileId)?postVars[fileId]:postVars;if(file instanceof Y.FileFlash){file.on("uploadstart",this._uploadEventHandler,this);file.on("uploadprogress",this._uploadEventHandler,this);file.on("uploadcomplete",this._uploadEventHandler,this);file.on("uploaderror",this._uploadEventHandler,this);file.on("uploadcancel",this._uploadEventHandler,this);file.startUpload(uploadURL,postVars,this.get("fileFieldName"));}},uploadAll:function(url,postvars){this.uploadThese(this.get("fileList"),url,postvars);},uploadThese:function(files,url,postvars){if(!this.queue){var uploadURL=url||this.get("uploadURL"),postVars=postvars||this.get("postVarsPerFile");this.queue=new UploaderQueue({simUploads:this.get("simLimit"),errorAction:this.get("errorAction"),fileFieldName:this.get("fileFieldName"),fileList:files,uploadURL:uploadURL,perFileParameters:postVars,retryCount:this.get("retryCount")});this.queue.on("uploadstart",this._uploadEventHandler,this);this.queue.on("uploadprogress",this._uploadEventHandler,this);this.queue.on("totaluploadprogress",this._uploadEventHandler,this);this.queue.on("uploadcomplete",this._uploadEventHandler,this);this.queue.on("alluploadscomplete",this._uploadEventHandler,this);this.queue.on("alluploadscancelled",function(){this.queue=null;},this);this.queue.on("uploaderror",this._uploadEventHandler,this);this.queue.startUpload();this.fire("uploadstart");}}},{FLASH_CONTAINER:'<div id="{swfContainerId}" style="position:absolute; top:0px; left: 0px; margin: 0; padding: 0; border: 0; width:100%; height:100%"></div>',SELECT_FILES_BUTTON:"<button type='button' class='yui3-button' tabindex='-1'>{selectButtonLabel}</button>",TYPE:"flash",NAME:"uploader",ATTRS:{appendNewFiles:{value:true},buttonClassNames:{value:{hover:"yui3-button-hover",active:"yui3-button-active",disabled:"yui3-button-disabled",focus:"yui3-button-selected"}},enabled:{value:true},errorAction:{value:"continue",validator:function(val){return(val===UploaderQueue.CONTINUE||val===UploaderQueue.STOP||val===UploaderQueue.RESTART_ASAP||val===UploaderQueue.RESTART_AFTER);}},fileFilters:{value:[]},fileFilterFunction:{value:null},fileFieldName:{value:"Filedata"},fileList:{value:[],getter:"_getFileList",setter:"_setFileList"},multipleFiles:{value:false},postVarsPerFile:{value:{}},selectButtonLabel:{value:"Select Files"},selectFilesButton:{valueFn:function(){return Y.Node.create(substitute(Y.UploaderFlash.SELECT_FILES_BUTTON,{selectButtonLabel:this.get("selectButtonLabel")}));}},simLimit:{value:2,validator:function(val){return(val>=2&&val<=5);}},swfURL:{valueFn:function(){var prefix=Y.Env.cdn+"uploader/assets/flashuploader.swf";if(Y.UA.ie>0){return(prefix+"?t="+Y.guid("uploader"));}return prefix;}},tabElements:{value:null},uploadURL:{value:""},retryCount:{value:3}}});Y.UploaderFlash.Queue=UploaderQueue;},"3.8.0",{requires:["swf","widget","substitute","base","cssbutton","node","event-custom","file-flash","uploader-queue"]});